CREATE TABLE `formation_ml` (
	`id` INT NOT NULL AUTO_INCREMENT,
	`description` VARCHAR(150) NULL DEFAULT NULL,
	`id_commune` INT NULL,
	`numero` INT NULL,
	`date_debut` DATE NULL,
	`date_fin` DATE NULL,
	`lieu` VARCHAR(100) NULL DEFAULT NULL,
	PRIMARY KEY (`id`),
	CONSTRAINT `FK__see_commune` FOREIGN KEY (`id_commune`) REFERENCES `see_commune` (`id`) ON UPDATE CASCADE
)
COLLATE='latin1_swedish_ci'
;

ALTER TABLE `formation_ml`
	ADD COLUMN `id_contrat_consultant_ong` INT NULL DEFAULT NULL AFTER `lieu`,
	ADD CONSTRAINT `FK_formation_ml_contrat_consultant_ong` FOREIGN KEY (`id_contrat_consultant_ong`) REFERENCES `contrat_consultant_ong` (`id`) ON UPDATE CASCADE;

CREATE TABLE `theme_formation_ml` (
	`id` INT NOT NULL AUTO_INCREMENT,
	`id_theme_sensibilisation` INT NULL,
	`numero` INT NULL,
	`date_formation` DATE NULL,
	`id_formation_ml` INT NULL,
	PRIMARY KEY (`id`),
	CONSTRAINT `FK__theme_sensibilisation` FOREIGN KEY (`id_theme_sensibilisation`) REFERENCES `theme_sensibilisation` (`id`) ON UPDATE CASCADE,
	CONSTRAINT `FK__formation_ml` FOREIGN KEY (`id_formation_ml`) REFERENCES `formation_ml` (`id`) ON UPDATE CASCADE
)
COLLATE='latin1_swedish_ci'
;

ALTER TABLE `consultant_ong`
	ADD COLUMN `id_village` INT NULL AFTER `nom_consultant`,
	ADD COLUMN `id_commune` INT NULL AFTER `id_village`,
	ADD COLUMN `id_region` INT NULL AFTER `id_commune`,
	ADD CONSTRAINT `FK_consultant_ong_see_village` FOREIGN KEY (`id_village`) REFERENCES `see_village` (`id`) ON UPDATE CASCADE,
	ADD CONSTRAINT `FK_consultant_ong_see_commune` FOREIGN KEY (`id_commune`) REFERENCES `see_commune` (`id`) ON UPDATE CASCADE,
	ADD CONSTRAINT `FK_consultant_ong_see_region` FOREIGN KEY (`id_region`) REFERENCES `see_region` (`id`) ON UPDATE CASCADE;
ALTER TABLE `pges`
	ADD COLUMN `id_village` INT NULL AFTER `id_sous_projet`,
	ADD COLUMN `id_infrastructure` INT NULL AFTER `id_village`,
	ADD CONSTRAINT `FK_pges_see_village` FOREIGN KEY (`id_village`) REFERENCES `see_village` (`id`) ON UPDATE CASCADE,
	ADD CONSTRAINT `FK_pges_infrastructure` FOREIGN KEY (`id_infrastructure`) REFERENCES `infrastructure` (`id`) ON UPDATE CASCADE;
ALTER TABLE `pges`
	ADD COLUMN `montant_total` DOUBLE NULL DEFAULT NULL AFTER `id_infrastructure`;
ALTER TABLE `pges_phases`
	ADD COLUMN `phase` VARCHAR(50) NULL DEFAULT NULL AFTER `id_pges`;

ALTER TABLE `see_phaseexecution`
	ADD COLUMN `pourcentage` FLOAT NULL DEFAULT NULL AFTER `datemodification`;
ALTER TABLE `pac`
	ADD COLUMN `id_village` INT(11) NULL AFTER `id_commune`,
	ADD COLUMN `id_type_agr` INT(11) NULL AFTER `id_zip`,
	ADD COLUMN `libelle` VARCHAR(50) NULL DEFAULT NULL AFTER `id_type_agr`,
	ADD CONSTRAINT `FK_pac_see_village` FOREIGN KEY (`id_village`) REFERENCES `see_village` (`id`) ON UPDATE CASCADE,
	ADD CONSTRAINT `FK_pac_type_agr` FOREIGN KEY (`id_type_agr`) REFERENCES `type_agr` (`id`) ON UPDATE CASCADE;

CREATE TABLE `pac_detail` (
	`id` INT NOT NULL AUTO_INCREMENT,
	`numero` INT NULL DEFAULT NULL,
	`besoin` VARCHAR(150) NULL DEFAULT NULL,
	`duree` FLOAT NULL DEFAULT NULL,
	`cout` DOUBLE NULL DEFAULT NULL,
	`calendrier_activite` VARCHAR(150) NULL DEFAULT NULL,
	`id_pac` INT NULL DEFAULT NULL,
	PRIMARY KEY (`id`),
	CONSTRAINT `FK__pac_pac_detail` FOREIGN KEY (`id_pac`) REFERENCES `pac` (`id`) ON UPDATE CASCADE
)
COLLATE='latin1_swedish_ci'
;

CREATE TABLE `outils_communication_ml` (
	`id` INT NOT NULL AUTO_INCREMENT,
	`outils_communication` VARCHAR(250) NULL DEFAULT NULL,
	`id_formation_ml` INT NULL DEFAULT NULL,
	PRIMARY KEY (`id`),
	CONSTRAINT `FK__outils_formation_ml` FOREIGN KEY (`id_formation_ml`) REFERENCES `formation_ml` (`id`) ON UPDATE CASCADE
)
COLLATE='latin1_swedish_ci'
;
ALTER TABLE `outils_communication_ml`
	CHANGE COLUMN `outils_communication` `outils_communication` LONGTEXT NULL DEFAULT NULL AFTER `id`;

CREATE TABLE `groupe_participant_formation_ml` (
	`id` INT NOT NULL AUTO_INCREMENT,
	`id_formation_ml` INT NULL,
	`id_village` INT NULL,
	`id_groupe_ml_pl` INT NULL,
	PRIMARY KEY (`id`),
	CONSTRAINT `FK__groupe_part_formation_ml` FOREIGN KEY (`id_formation_ml`) REFERENCES `formation_ml` (`id`) ON UPDATE CASCADE,
	CONSTRAINT `FK__groupe_part_see_village` FOREIGN KEY (`id_village`) REFERENCES `see_village` (`id`) ON UPDATE CASCADE,
	CONSTRAINT `FK__groupe_part_groupe_ml_pl` FOREIGN KEY (`id_groupe_ml_pl`) REFERENCES `groupe_ml_pl` (`id`) ON UPDATE CASCADE
)
COLLATE='latin1_swedish_ci'
;
CREATE TABLE `realisation_ebe` (
	`id` INT NOT NULL AUTO_INCREMENT,
	`numero` INT NULL DEFAULT '0',
	`but_regroupement` VARCHAR(150) NULL DEFAULT NULL,
	`date_regroupement` DATE NULL DEFAULT NULL,
	`materiel` VARCHAR(150) NULL DEFAULT NULL,
	`lieu` VARCHAR(150) NULL DEFAULT NULL,
	`id_ml_pl` INT NULL DEFAULT NULL,
	`id_contrat_consultant_ong` INT NULL DEFAULT NULL,
	PRIMARY KEY (`id`),
	CONSTRAINT `FK_realisation_ebe_liste_ml_pl` FOREIGN KEY (`id_ml_pl`) REFERENCES `liste_ml_pl` (`id`) ON UPDATE CASCADE,
	CONSTRAINT `FK_realisation_ebe_contrat_consultant_ong` FOREIGN KEY (`id_contrat_consultant_ong`) REFERENCES `contrat_consultant_ong` (`id`) ON UPDATE CASCADE
)
COLLATE='latin1_swedish_ci'
;

CREATE TABLE `theme_formation_ebe` (
	`id` INT NOT NULL AUTO_INCREMENT,
	`theme_sensibilisation` VARCHAR(150) NULL DEFAULT NULL,
	`activite` VARCHAR(200) NULL DEFAULT NULL,
	`id_realisation_ebe` INT NULL DEFAULT NULL,
	PRIMARY KEY (`id`),
	CONSTRAINT `FK_theme_realisation_ebe` FOREIGN KEY (`id_realisation_ebe`) REFERENCES `realisation_ebe` (`id`) ON UPDATE CASCADE
)
COLLATE='latin1_swedish_ci'
;
CREATE TABLE `participant_realisation_ebe` (
	`id` INT NOT NULL AUTO_INCREMENT,
	`id_realisation_ebe` INT NULL,
	`id_menage_ml_pl` INT NULL,
	PRIMARY KEY (`id`),
	CONSTRAINT `FK_participant_realisation_ebe` FOREIGN KEY (`id_realisation_ebe`) REFERENCES `realisation_ebe` (`id`) ON UPDATE CASCADE,
	CONSTRAINT `FK_participant_menage` FOREIGN KEY (`id_menage_ml_pl`) REFERENCES `menage` (`id`) ON UPDATE CASCADE
)
COLLATE='latin1_swedish_ci'
;
ALTER TABLE `realisation_ebe`
	DROP COLUMN `id_ml_pl`,
	DROP INDEX `FK_realisation_ebe_liste_ml_pl`,
	DROP FOREIGN KEY `FK_realisation_ebe_liste_ml_pl`;
ALTER TABLE `realisation_ebe`
	ADD COLUMN `id_groupe_ml_pl` INT(11) NULL DEFAULT NULL AFTER `id_contrat_consultant_ong`,
	ADD CONSTRAINT `FK_realisation_ebe_groupe_ml_pl` FOREIGN KEY (`id_groupe_ml_pl`) REFERENCES `groupe_ml_pl` (`id`) ON UPDATE CASCADE;
ALTER TABLE `participant_realisation_ebe`
	DROP COLUMN `id_menage_ml_pl`,
	DROP INDEX `FK_participant_menage`,
	DROP FOREIGN KEY `FK_participant_menage`;
ALTER TABLE `participant_realisation_ebe`
	ADD COLUMN `id_menage` INT(11) NULL DEFAULT NULL AFTER `id_realisation_ebe`,
	ADD CONSTRAINT `FK_participant_realisation_ebe_menage` FOREIGN KEY (`id_menage`) REFERENCES `menage` (`id`) ON UPDATE CASCADE;
ALTER TABLE `see_phaseexecution`
	ADD COLUMN `id_sous_projet` INT NULL DEFAULT NULL AFTER `pourcentage`,
	ADD CONSTRAINT `FK_see_phaseexecution_sous_projet` FOREIGN KEY (`id_sous_projet`) REFERENCES `sous_projet` (`id`) ON UPDATE CASCADE;
